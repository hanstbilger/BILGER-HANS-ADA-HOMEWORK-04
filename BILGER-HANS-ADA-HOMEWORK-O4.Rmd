---
title: "BILGER-HANS-ADA-HOMEWORK-04"
author: "Hans Bilger"
date: "April 14, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

####Load in Kamilar and Cooper data
```{r}
library(readr)
d <- read_csv("KamilarAndCooper")
head(d)
```


####[1] Using the “KamilarAndCooperData.csv” dataset, run a linear regression looking at log(HomeRange_km2) in relation to log(Body_mass_female_mean) and report your β coeffiecients (slope and intercept).
```{r}

model <- lm(data=d, log(HomeRange_km2)~log(Body_mass_female_mean))
summary(model)
model$coefficients
coef(summary(model))[1,1]

# b0 (intercept) = -9.44
# b1 (slope) = 1.036

```

####[2] Then, use bootstrapping to sample from your data 1000 times with replacement, each time fitting the same model and calculating the appropriate coefficients. [The size of each sample should be equivalent to the number of observations in your dataset.] This generates a sampling distribution for each β coefficient. Plot a histogram of these sampling distributions.

```{r}
# b0 histogram
library(boot)
library(tidyverse)
s <- function(data,b,formula){  
	sim = sample_n(d, 213, replace = TRUE)
	return(lm(data=sim, log(HomeRange_km2)~log(Body_mass_female_mean))$coef[1])  
	}
b0 <- boot(data=sim, statistic=s, R=1000) 
hist(b0$t, breaks = 100)
```

```{r}
#b1 histogram
s <- function(data,b,formula){  
	sim = sample_n(d, 213, replace = TRUE)
	return(lm(data=sim, log(HomeRange_km2)~log(Body_mass_female_mean))$coef[2])  
	}
b1 <- boot(data=sim, statistic=s, R=1000) 
mean(b1$t)
hist(b1$t, breaks = 100)
```

####[3] Estimate the standard error for each of your β coefficients as the standard deviation of the sampling distribution from your bootstrap.
```{r}
# Standard error of b0
SE_b0_boot <- sd(b0$t)
SE_b0_boot
# Standard error of b1
SE_b1_boot <- sd(b1$t)
SE_b1_boot
```

#### [4] Also determine the 95% CI for each of your β coefficients based on the appropriate quantiles from your sampling distribution.
```{r}
b0_CI_boot <- boot.ci(boot.out = b0, type = c("norm"))
b0_CI_boot
b1_CI_boot <- boot.ci(boot.out = b1, type = c("norm"))
b1_CI_boot
```
#### [5] How does your answer to part [3] compare to the SE estimated from your entire dataset using the formula for standard error implemented in lm()?

```{r}
mod_1 <- lm(data=d, log(HomeRange_km2)~log(Body_mass_female_mean))
summary(mod_1)
SE_b1 <- .0849
SE_b1
SE_b1_boot
SE_b0 <- .673
SE_b0
SE_b0_boot

Pdiff_b1 <- 100*(1-SE_b1_boot/SE_b1)
Pdiff_b1
Pdiff_b0 <- 100*(1-SE_b0_boot/SE_b0)
Pdiff_b0

# The bootstrap Standard Errors are ~8-11% lower than the lm() Standard Errors.
```


#### [6] How does your answer to part [4] compare to the 95% CI estimated from your entire dataset?

```{r}
mod_1 <- lm(data=d, log(HomeRange_km2)~log(Body_mass_female_mean))
summary(mod_1)
?confint
confint(mod_1, 'log(Body_mass_female_mean)', level=0.95)
```








```{r}
b0 <- x$coefficients[[1]]
b1 <- x$coefficients[[2]]
coefs <- c(b0, b1)

lm(data=d, log(HomeRange_km2)~log(Body_mass_female_mean))$coef[1]

nb = 5000 ; bet = NULL ; n = nrow(d)
ptm <- proc.time() # have a look at the time it takes
for (i in 1:nb){
unifnum = sample(c(1:n),n,replace = T)	# pick random indices
bet[i] = lm(data[unifnum,1]~data[unifnum,2])$coef[2]
	}
proc.time() - ptm # about 80 seconds on my end

for (i in 1:1000) {
    sim[i] <- sample(x, n, replace = TRUE)
    temp <- d[i, ]
    temp_mod <- lm(data=temp, log(HomeRange_km2)~log(Body_mass_female_mean))
    coeff = matrix(data=coefficients(temp_mod), ncol=2)
    results[b, ] = coeff
}
hist(sim, xlab = "Mean of d", main = "Distribution of Means of Simulated Samples")

sim_test <- sample_n(d, 213, replace = TRUE)
str(sim_test)
coef(summary(lm(data=sim_test, log(HomeRange_km2)~log(Body_mass_female_mean))))[[1]]
coef(summary(lm(data=sim_test, log(HomeRange_km2)~log(Body_mass_female_mean))))[[2]]


n = nrow(d)
B = 1000 ## number of bootstraps
results = numeric(B) ## vector to hold results
for(b in 1:B){
  i = sample_n(x=1:000, size = 1000, replace = TRUE) ## sample indices
  bootSample = d[i] ## get data
  thetaHat = lm(data=bootSample, log(HomeRange_km2)~log(Body_mass_female_mean))
  results[b] = thetaHat ## store results
}

b0 <- for (i in 1:1000) {
    sim <- sample_n(d, 213, replace = TRUE)
    b0[i] <- coef(summary(lm(data=sim, log(HomeRange_km2)~log(Body_mass_female_mean))))[[1]]
}


b0(lm(data=d, log(HomeRange_km2)~log(Body_mass_female_mean)), d, 213)

test <- function(){
    sim <- sample_n(d, 213, replace = TRUE)
    mod[i] <- lm(data=sim, log(HomeRange_km2)~log(Body_mass_female_mean))
    b0[i] <- mod$coefficients[[1]]
    b1[i] <- mod$coefficients[[2]]
}

test <- select(d, Body_mass_female_mean, HomeRange_km2)
test <- na.omit(test)

library(tidyverse)
sim = NULL
mod = NULL
b0 = NULL
b1 = NULL
coefs = NULL
xsdf <- sample_n(test, 137, replace = TRUE)

b1_boot <- for (b in 1:1000) {
    i <- sample(x = 1:n, size = n, replace = TRUE)
    bootSample <- test[i]
    thetaHat <- lm(data=bootSample, log(HomeRange_km2)~log(Body_mass_female_mean))
    b0[b] <- thetaHat$coefficients[[1]]
    b1[b] <- thetaHat$coefficients[[2]]
}

for (i in 1:1000) {
  sim[i] <- sample_n(d, 213, replace = TRUE)
}


hist(sim, xlab = "Mean of d", main = "Distribution of Means of Simulated Samples")




modf <- function(x) {
  x <- lm(data=d, log(HomeRange_km2)~log(Body_mass_female_mean))
  b0 <- x$coefficients[[1]]
  b1 <- x$coefficients[[2]]
  coefs <- c(b0, b1)
  return(coefs)
}

for (i in 1:1000) {
    sim[i] <- sample(x, n, replace = TRUE)
    temp <- d[i, ]
    temp_mod <- lm(data=temp, log(HomeRange_km2)~log(Body_mass_female_mean))
    coeff = matrix(data=coefficients(temp_mod), ncol=2)
    results[b, ] = coeff
}
hist(sim, xlab = "Mean of d", main = "Distribution of Means of Simulated Samples")
install.packages("simpleboot")
library(simpleboot)
lmodel <- lm(data=d, log(HomeRange_km2)~log(Body_mass_female_mean))
lboot <- lm.boot(lmodel, R = 1000)
```























```{r}
modf <- function(x) {
  x <- lm(data=d, log(HomeRange_km2)~log(Body_mass_female_mean))
  b0 <- x$coefficients[[1]]
  b1 <- x$coefficients[[2]]
  coefs <- c(b0, b1)
  return(coefs)
}

modf()

```

```{r}


```

```{r}


```

```{r}


```